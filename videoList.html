<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script>
      function getJsonFromUrl(url) {
        if (!url) url = location.search;
        var query = url.substr(1);
        var result = {};
        query.split("&").forEach(function (part) {
          var item = part.split("=");
          result[item[0]] = decodeURIComponent(item[1]);
        });
        return result;
      }
    </script>
    <script>
      $(document).ready(function () {
        try {
          console.log("HERE");
          if (!window.location.search)
            throw new Error("No query params provided.");
          const { p } = getJsonFromUrl(window.location.search);
          console.log("HERE2");
          $.getJSON(
            `https://ssepac.xyz/videos/list?p=${p}`,
            function (data, status) {
              if (data) {
                const list = data.files.reduce(
                  (acc, file) =>
                    acc.concat(
                      `<li><a href='https://ssepac.xyz/video?fileName=${file}&p=${p}'>${file}</a></li>`
                    ),
                  ""
                );
                $("#movieList").html(`<ul>${list}</ul>`);
              } else {
                $("movieList").html("<p>Could not get movie list</p>");
              }
            }
          ).fail(function (err) {
            console.log("FAILED");
          });
        } catch (err) {
          $("movieList").html("<p>Could not get movie list</p>");
        }
      });
    </script>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SFLIX LIST</title>
  </head>

  <body>
    <h1>SFlix Movie List</h1>
    <div id="movieList"></div>
  </body>
</html>
